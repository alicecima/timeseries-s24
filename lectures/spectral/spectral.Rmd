---
title: 'Lecture 5: Spectral Analysi and Filtering'
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_folding: show
---

```{r, include=FALSE}
knitr::opts_chunk$set(dev = c("png", "pdf"), fig.path = "fig/",
                     cache = TRUE, autodep = TRUE, cache.comments = TRUE)
```

# Load packages

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(astsa)
library(fpp3)
library(epidatasets)
```

# Periodic processes

```{r cos-process}
n = 100
t = 1:n
x1 = sqrt(2^2 + 3^2)*cos(2*pi*t*3/n + atan(-3/2))
y1 = 2*cos(2*pi*t*3/n) + 3*sin(2*pi*t*3/n)

x2 = sqrt(4^2 + 5^2)*cos(2*pi*t*6/n + atan(-5/4))
y2 = 4*cos(2*pi*t*6/n) + 5*sin(2*pi*t*6/n)

par(mar = c(4.5, 4.5, 0.5, 0.5))
matplot(t, cbind(x1, y1), type = "l", lty = 1:2, col = 1:2, xlab = "Time",
        ylab = "", ylim = c(-10, 10))
matplot(t, cbind(x2, y2), type = "l", lty = 1:2, col = c(8,4), add = TRUE)
rect(-atan(-3/2)*n/3*1/(2*pi), -20, n/3 - atan(-3/2)*n/3*1/(2*pi), 20,
     border = NA, col = rgb(1, 0, 0, 0.2))
rect(3*n/6 - atan(-5/4)*n/6*1/(2*pi), -20, 4*n/6 - atan(-6/4)*n/6*1/(2*pi), 20,
     border = NA, col = rgb(0, 0, 1, 0.2))
```

# Mixtures

```{r cos-mixture}
par(mfrow = c(2, 1), mar = c(4.5, 4.5, 0.5, 0.5))
plot(t, y1 + y2, type = "l", xlab = "Time", ylab = "")

y3 = 6*cos(2*pi*t*18/100) + 7*sin(2*pi*t*18/100)
plot(t, y1 + y2 + y3, type = "l", xlab = "Time", ylab = "")
```

# Periodogram, mixture data

```{r periodogram-mix}
P = Mod(fft(y1 + y2))^2 / n
Q = Mod(fft(y1 + y2 + y3))^2 / n

par(mfrow = c(2, 1), mar = c(4.5, 4.5, 0.5, 0.5))
plot(0:(n-1)/n, P, type = "h", xlab = "Frequency", ylab = "Periodogram", 
     xlim = c(0, 0.5), lwd = 3)
abline(v = 0.5, lty = 2, col = 2)
plot(0:(n-1)/n, Q, type = "h", xlab = "Frequency", ylab = "Periodogram",  
     xlim = c(0, 0.5), lwd = 3)
abline(v = 0.5, lty = 2, col = 2)
```

# Periodogram, star data

```{r periodogram-star}
n = length(star)
Per = Mod(fft(star - mean(star)))^2 / n
Freq = 0:(n-1)/n

par(mfrow = c(2, 1), mar = c(4.5, 4.5, 0.5, 0.5))
plot(star, ylab="Star magnitude", xlab = "Day")
plot(Freq, Per, type = "h", xlab = "Frequency", ylab = "Periodogram",  
     xlim = c(0, 0.08), lwd = 3)
text(0.05, 7000, "24 day cycle")
text(0.027, 9000, "29 day cycle")
```